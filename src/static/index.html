<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Macro App</title>
    <style>
        #debug { font-family: monospace; white-space: pre; max-height: 300px; overflow-y: auto; }
        #transcriptionBox { width: 100%; height: 150px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Audio Macro App</h1>
    <button id="startButton">Start Recording</button>
    <button id="stopButton" disabled>Stop Recording</button>
    <div id="status"></div>
    <textarea id="transcriptionBox" placeholder="Transcription will appear here..."></textarea>
    <h3>Debug Messages:</h3>
    <div id="debug"></div>

    <script>
        const socket = new WebSocket('ws://localhost:8000/ws');
        let isRecording = false;

        document.getElementById('startButton').onclick = startRecording;
        document.getElementById('stopButton').onclick = stopRecording;

        function updateStatus(message) {
            document.getElementById('status').innerText = message;
            console.log('Status:', message);
        }

        function updateTranscription(text) {
            document.getElementById('transcriptionBox').value = text;
        }

        function appendDebug(message) {
            const debugElement = document.getElementById('debug');
            debugElement.innerText += message + '\n';
            debugElement.scrollTop = debugElement.scrollHeight;
            console.log('Debug:', message);
        }

        function startRecording() {
            if (!isRecording) {
                socket.send(JSON.stringify({ action: 'start' }));
                isRecording = true;
                document.getElementById('startButton').disabled = true;
                document.getElementById('stopButton').disabled = false;
                updateStatus('Recording started');
                appendDebug('Recording started: sent action start to WebSocket');
            }
        }

        function stopRecording() {
            if (isRecording) {
                socket.send(JSON.stringify({ action: 'stop' }));
                isRecording = false;
                document.getElementById('startButton').disabled = false;
                document.getElementById('stopButton').disabled = true;
                updateStatus('Recording stopped');
                appendDebug('Recording stopped: sent action stop to WebSocket');
            }
        }

        socket.onopen = function(event) {
            updateStatus('Connected to server');
            appendDebug('WebSocket connection established');
        };

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            console.log('Received data:', data);

            if (data.status) {
                updateStatus(data.status);
            }
            if (data.text && data.action === 'update') {
                updateTranscription(data.text);
            }

            appendDebug(`Received from WebSocket: ${JSON.stringify(data, null, 2)}`);
        };

        socket.onerror = function(error) {
            console.error(`WebSocket Error: ${error}`);
            updateStatus('WebSocket Error');
            appendDebug(`WebSocket Error: ${error}`);
        };

        socket.onclose = function(event) {
            updateStatus('Disconnected from server');
            appendDebug(`WebSocket closed: ${event.reason}`);
        };
    </script>
</body>
</html>